{"version":3,"sources":["../src/alert_ctrl.js"],"names":["_","MetricsPanelCtrl","AlertCtrl","$scope","$injector","panelDefaults","USE_FAKE_DATA","fakeData","USE_URL","url","request","updateInterval","defaultsDeep","panel","events","on","onDataReceived","bind","onDataError","onInitEditMode","bgColor","updateData","that","xmlhttp","window","XMLHttpRequest","ActiveXObject","onreadystatuschange","readyStatue","status","UrlData","JSON","parse","responseText","open","send","$timeout","data","dataList","eval","transform","render","map","item","statue","err","addEditorTab","scope","elem","attrs","ctrl","renderingCompleted","templateUrl"],"mappings":"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","file":"alert_ctrl.js","sourcesContent":["import _ from 'lodash';\r\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\r\nimport './css/alert-panel.css!';\r\n\r\nexport class AlertCtrl extends MetricsPanelCtrl {\r\n  constructor($scope, $injector) {\r\n    super($scope, $injector);\r\n\r\n    const panelDefaults = {\r\n      USE_FAKE_DATA: true,\r\n      fakeData: \"[\\n        {\\n          time: '2017-05-06 12:39',\\n          statue: '0',\\n          info: [\\n            {\\n              name: '告警信息',\\n              value: 'daidjaoesiadasdfdsafgsdfsdafdsfa'\\n            },\\n            {\\n              name: '告警源',\\n              value: '192.168.24.223'\\n            }\\n          ]\\n        },\\n        {\\n          time: '2017-05-06 12:45',\\n          statue: '1',\\n          info: [\\n            {\\n              name: '告警信息',\\n              value: 'daidjaossfasfasdfafsafasfsafsafsafs'\\n            },\\n            {\\n              name: '告警源',\\n              value: '192.168.24.223'\\n            }\\n          ]\\n        },\\n        {\\n          time: '2017-05-06 12:48',\\n          statue: '2',\\n          info: [\\n            {\\n              name: '告警信息',\\n              value: 'daidjaosfasdfasfasfsafsdfsafasfsafassi'\\n            },\\n            {\\n              name: '告警源',\\n              value: '192.168.24.223'\\n            }\\n          ]\\n        }\\n      ]\",\r\n      USE_URL: true,\r\n      url: '',\r\n      request: '',\r\n      updateInterval: 10000\r\n    };\r\n\r\n    _.defaultsDeep(this.panel, panelDefaults);\r\n\r\n    this.events.on('data-received', this.onDataReceived.bind(this));\r\n    this.events.on('data-error', this.onDataError.bind(this));\r\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\r\n    this.bgColor = [\r\n      // \"linear-gradient(to bottom right, #3abac7, #a375b6)\",\r\n      // \"linear-gradient(to bottom right, #fcd98d, #f3b65b)\",\r\n      // \"linear-gradient(to bottom right, #ffb88c, #e5658f)\",\r\n      // \"linear-gradient(to bottom right, #4acda5, #3f74c6)\",\r\n      '#EA4A2D',\r\n      '#2D94D7',\r\n      '#fdb225'\r\n    ];\r\n\r\n    this.updateData();\r\n  }\r\n\r\n  //post请求\r\n  updateData() {\r\n    let that = this, xmlhttp;\r\n\r\n    if (window.XMLHttpRequest) {\r\n      xmlhttp = new XMLHttpRequest();\r\n    } else {\r\n      xmlhttp = new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n    }\r\n\r\n    xmlhttp.onreadystatuschange = function () {\r\n      if (xmlhttp.readyStatue == 4 && xmlhttp.status == 200) {\r\n        that.UrlData = JSON.parse(xmlhttp.responseText);\r\n        that.onDataReceived();\r\n      }\r\n    };\r\n\r\n    if (that.panel.USE_URL && !that.panel.USE_FAKE_DATA && that.panel.url && that.panel.request) {\r\n      xmlhttp.open(\"POST\", that.panel.url, true);\r\n      xmlhttp.send(that.panel.request);\r\n    } else {\r\n      xmlhttp = null;\r\n    }\r\n\r\n    this.$timeout(() => { this.updateData(); }, that.panel.updateInterval);\r\n  }\r\n\r\n  onDataReceived(data) {\r\n    this.dataList = this.panel.USE_URL ? this.UrlData : data;\r\n\r\n    if (this.panel.USE_URL && this.panel.USE_FAKE_DATA && this.panel.fakeData) {\r\n      this.dataList = eval(this.panel.fakeData);\r\n    }\r\n\r\n    this.transform();\r\n    this.render();\r\n  }\r\n\r\n  transform() {\r\n    let that = this;\r\n    \r\n    that.dataList.map(item => {\r\n      item.bgColor = that.bgColor[item.statue % 3];\r\n    });\r\n  }\r\n\r\n  onDataError(err) {\r\n    this.render();\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.addEditorTab('设置', 'public/plugins/dxc-alert-panel/editor.html', 2);\r\n  }\r\n\r\n  link(scope, elem, attrs, ctrl) {\r\n    // const $panelContainer = elem.find('.list-container');\r\n\r\n    function render() {\r\n\r\n    }\r\n\r\n    this.events.on('render', () => {\r\n      render();\r\n      ctrl.renderingCompleted();\r\n    });\r\n  }\r\n}\r\n\r\nAlertCtrl.templateUrl = 'module.html';\r\n"]}