{"version":3,"sources":["../src/status_ctrl.js"],"names":["_","MetricsPanelCtrl","panelDefaults","bgColor","fakeData","url","USE","request","updateInterval","StatusCtrl","$scope","$injector","defaultsDeep","panel","events","on","onDataReceived","bind","onDataError","onInitEditMode","that","setTimeout","updateData","render","dataList","UrlData","eval","data","xmlhttp","window","XMLHttpRequest","ActiveXObject","onreadystatechange","readyState","status","JSON","parse","responseText","open","send","$timeout","addEditorTab","scope","elem","attrs","ctrl","templateUrl"],"mappings":"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","file":"status_ctrl.js","sourcesContent":["import _ from 'lodash';\r\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\r\nimport './css/status-panel.css!';\r\n\r\nconst panelDefaults = {\r\n  // IS_POINT: true,\r\n  // url: '',\r\n  // request: '',\r\n  // updateInterval: 10000,\r\n  bgColor: [\r\n    'linear-gradient(to bottom right, #3abac7, #a375b6)',\r\n    'linear-gradient(to bottom right, #fcd98d, #f3b65b)',\r\n    'linear-gradient(to bottom right, #ffb88c, #e5658f)'\r\n    // ],\r\n    // statusColor: [\r\n    //   \"linear-gradient(to bottom right, #4acda5, #3f74c6)\",\r\n    //   \"linear-gradient(to bottom right, #3abac7, #a375b6)\",\r\n    //   \"linear-gradient(to bottom right, #ffb88c, #e5658f)\"\r\n  ],\r\n  fakeData: \"[{ 'name': '兖矿电邮', 'status': '1' }, { 'name': '人力资源', 'status': '2' }, { 'name': '兖矿OA', 'status': '0' }, { 'name': '全面预算系统', 'status': '0' }, { 'name': '内部市场化系统', 'status': '0' }, { 'name': '呼叫中心', 'status': '0' }, { 'name': '地测部GIS', 'status': '0' }, { 'name': '基建PMIS', 'status': '0' }, { 'name': '安监局安全信息联网', 'status': '0' }, { 'name': '实时数据联网', 'status': '1' }, { 'name': '审计系统', 'status': '2' }, { 'name': '总院PACS', 'status': '1' }, { 'name': '煤业资金', 'status': '0' }, { 'name': '煤化工能源管控', 'status': '0' }, { 'name': '物资商城', 'status': '0' }, { 'name': '环保节能系统', 'status': '1' }, { 'name': '短信平台', 'status': '2' }, { 'name': '矿井微震联网系统', 'status': '0' }, { 'name': '纪委网上举报', 'status': '1' }, { 'name': '综合调度管理信息系统', 'status': '0' }, { 'name': '综合运营', 'status': '0' }, { 'name': '考勤', 'status': '0' }, { 'name': '矿井微震联网系统', 'status': '0' }, { 'name': '计划生育', 'status': '0' },{ 'name': '集团风险管理', 'status': '0' }]\",\r\n  url: '',\r\n  USE: 'FAKE_DATA',\r\n  request: '',\r\n  updateInterval: 10000\r\n};\r\n\r\nexport class StatusCtrl extends MetricsPanelCtrl {\r\n  constructor($scope, $injector) {\r\n    super($scope, $injector);\r\n\r\n    _.defaultsDeep(this.panel, panelDefaults);\r\n\r\n    this.events.on('data-received', this.onDataReceived.bind(this));\r\n    this.events.on('data-error', this.onDataError.bind(this));\r\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\r\n    // this.update();\r\n    if (this.panel.USE === 'FAKE_DATA' && this.panel.fakeData) {\r\n      let that = this;\r\n      setTimeout(function () {\r\n        that.onDataReceived(that.panel.fakeData);\r\n      }, 500);\r\n    } else {\r\n      this.updateData();\r\n    }\r\n  }\r\n\r\n  onDataError() {\r\n    this.render();\r\n  }\r\n  onDataReceived(dataList) {\r\n    this.dataList = this.panel.USE === 'URL' ? this.UrlData : dataList;\r\n\r\n    if (this.panel.USE === 'FAKE_DATA' && this.panel.fakeData) {\r\n      this.dataList = eval(this.panel.fakeData); // jshint ignore:line\r\n    }\r\n    this.data = this.dataList;\r\n    this.render();\r\n  }\r\n\r\n  //post请求\r\n  updateData() {\r\n    let that = this, xmlhttp;\r\n\r\n    if (window.XMLHttpRequest) {\r\n      xmlhttp = new XMLHttpRequest();\r\n    } else {\r\n      xmlhttp = new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n    }\r\n\r\n    xmlhttp.onreadystatechange = function () {\r\n      if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {\r\n        that.UrlData = JSON.parse(xmlhttp.responseText);\r\n        that.onDataReceived();\r\n      }\r\n    };\r\n\r\n    if (that.panel.USE === 'URL' && that.panel.url && that.panel.request) {\r\n      xmlhttp.open(\"POST\", that.panel.url, true);\r\n      xmlhttp.send(that.panel.request);\r\n    } else {\r\n      xmlhttp = null;\r\n    }\r\n\r\n    this.$timeout(() => { this.updateData(); }, that.panel.updateInterval);\r\n  }\r\n\r\n\r\n  onInitEditMode() {\r\n    this.addEditorTab('数据配置', 'public/plugins/dxc-status-panel/editer-metric.html', 2);\r\n  }\r\n\r\n  link(scope, elem, attrs, ctrl) {\r\n    this.events.on('render', () => {\r\n      // const $panelContainer = elem.find('.list-container');\r\n    });\r\n  }\r\n}\r\n\r\nStatusCtrl.templateUrl = 'module.html';\r\n"]}